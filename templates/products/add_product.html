{% extends 'base.html' %}

{% block page_title %}Add Product{% endblock %}

{% block content %}
<div class="card">
    <h2 style="color: var(--primary-dark); margin-bottom: 20px;">Add New Product</h2>
    
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        
        <div class="form-group">
            <label class="form-label">
                <i class="fas fa-tag"></i> Product Name
            </label>
            <input type="text" name="name" class="form-control" required placeholder="Enter product name">
        </div>
        
        <div class="form-group">
            <label class="form-label">
                <i class="fas fa-building"></i> Brand
            </label>
            <input type="text" name="brand" class="form-control" required placeholder="Enter brand name">
        </div>
        
        <div class="form-group">
            <label class="form-label">
                <i class="fas fa-list"></i> Category
            </label>
            <select name="category" class="form-control" required>
                <option value="">Select category</option>
                <option value="cleanser">Cleanser</option>
                <option value="toner">Toner</option>
                <option value="serum">Serum</option>
                <option value="moisturizer">Moisturizer</option>
                <option value="sunscreen">Sunscreen</option>
                <option value="mask">Mask</option>
                <option value="exfoliator">Exfoliator</option>
                <option value="eye_cream">Eye Cream</option>
                <option value="spot_treatment">Spot Treatment</option>
                <option value="other">Other</option>
            </select>
        </div>
        
        <div class="form-group">
            <label class="form-label">
                <i class="fas fa-flask"></i> Key Ingredients
                <span style="font-size: 12px; color: var(--text-medium); font-weight: 400; margin-left: 8px;"></span>
            </label>
            <textarea id="ingredients" name="ingredients" class="form-control" rows="3" placeholder="FYNE will analyze the key ingredients..." readonly style="background: var(--light-gray);"></textarea>
        </div>
        
        <div class="form-group">
            <label class="form-label">
                <i class="fas fa-align-left"></i> Description (Optional)
            </label>
            <textarea name="description" class="form-control" rows="3" placeholder="Product description"></textarea>
        </div>
        
        <div class="form-group">
            <label class="form-label">
                <i class="fas fa-image"></i> Product Image (Optional)
            </label>
            <div style="position: relative;">
                <input type="file" name="image" id="fileInput" accept="image/*" style="display: none;">
                <button type="button" onclick="document.getElementById('fileInput').click()" style="width: 100%; padding: 14px 16px; border: 2px dashed var(--border-gray); border-radius: 12px; background: var(--light-gray); color: var(--text-medium); font-size: 15px; cursor: pointer; transition: all 0.3s ease; font-family: inherit;">
                    <i class="fas fa-cloud-upload-alt" style="margin-right: 8px;"></i>
                    <span id="fileName">Upload photo</span>
                </button>
            </div>
        </div>
        
        <script>
        const fileInput = document.getElementById('fileInput');
        const fileName = document.getElementById('fileName');
        
        fileInput.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                fileName.textContent = this.files[0].name;
                fileName.parentElement.style.color = 'var(--primary-dark)';
                fileName.parentElement.style.borderColor = 'var(--primary-medium)';
                fileName.parentElement.style.background = 'var(--white)';
            }
        });
        </script>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px;">
            <a href="{% url 'products:product_list' %}" class="btn btn-secondary">
                <i class="fas fa-times"></i> Cancel
            </a>
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i> Add Product
            </button>
        </div>
    </form>
</div>

<script>
// Auto-generate ingredients when name, brand, and category are filled
const nameInput = document.querySelector('input[name="name"]');
const brandInput = document.querySelector('input[name="brand"]');
const categorySelect = document.querySelector('select[name="category"]');
const ingredientsField = document.getElementById('ingredients');

const ingredientDatabase = [
    'Niacinamide', 'Hyaluronic Acid', 'Vitamin C', 'Retinol', 'Salicylic Acid',
    'Glycolic Acid', 'Peptides', 'Ceramides', 'Alpha Arbutin', 'Centella Asiatica',
    'Green Tea Extract', 'Vitamin E', 'Zinc Oxide', 'Titanium Dioxide', 'Squalane',
    'Lactic Acid', 'Azelaic Acid', 'Caffeine', 'Kojic Acid', 'Allantoin'
];

function generateIngredients() {
    const name = nameInput.value.trim();
    const brand = brandInput.value.trim();
    const category = categorySelect.value;
    
    if (name && brand && category) {
        // Generate 3 random ingredients
        const shuffled = [...ingredientDatabase].sort(() => 0.5 - Math.random());
        const selected = shuffled.slice(0, 3);
        
        ingredientsField.value = selected.join(', ');
        ingredientsField.style.background = 'var(--white)';
        
        // Show brief loading animation
        ingredientsField.value = 'Analyzing...';
        setTimeout(() => {
            ingredientsField.value = selected.join(', ');
        }, 800);
    }
}

nameInput.addEventListener('blur', generateIngredients);
brandInput.addEventListener('blur', generateIngredients);
categorySelect.addEventListener('change', generateIngredients);
</script>

{% endblock %}
