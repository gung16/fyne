{% extends 'base.html' %}

{% block page_title %}Dashboard{% endblock %}

{% block content %}

<!-- Welcome Section -->
<section class="mb-5">
    <div class="relative overflow-hidden rounded-3xl bg-gradient-to-br from-fyne-soft via-white to-fyne-soft px-5 py-4 shadow-sm border border-white/60">
        <div class="absolute -right-10 -bottom-10 h-28 w-28 rounded-full bg-fyne-blush/40 blur-3xl"></div>
        <div class="relative">
            <p class="text-xs font-semibold tracking-[0.18em] uppercase text-fyne-rose/80 mb-1">
                Hi, {{ user.username }} ðŸ‘‹
            </p>
            <h2 class="text-xl font-semibold text-fyne-deep mb-1">
                Your skin at a glance
            </h2>
            <p class="text-xs text-slate-500">
                Hereâ€™s your skincare summary for today.
            </p>
        </div>
    </div>
</section>

<!-- Today's Skin Score -->
{% if latest_progress %}
<section class="mb-5">
    <div class="rounded-3xl bg-white shadow-sm border border-slate-100 px-5 py-4">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-sm font-semibold text-fyne-deep">
                Today's Skin Score
            </h3>
            <span class="inline-flex items-center gap-1 rounded-full px-3 py-1 text-[11px] font-medium
                {% if latest_progress.improvement_trend == 'improving' %}
                    bg-emerald-50 text-emerald-700
                {% elif latest_progress.improvement_trend == 'declining' %}
                    bg-rose-50 text-rose-700
                {% else %}
                    bg-slate-50 text-slate-700
                {% endif %}
            ">
                <i class="fas fa-arrow-
                    {% if latest_progress.improvement_trend == 'improving' %}
                        up
                    {% elif latest_progress.improvement_trend == 'declining' %}
                        down
                    {% else %}
                        right
                    {% endif %}
                text-[10px]"></i>
                {{ latest_progress.get_improvement_trend_display }}
            </span>
        </div>

        <div class="flex items-center justify-center mb-3">
            <!-- Simple circular score indicator -->
            <div class="relative h-32 w-32 rounded-full bg-gradient-to-br from-fyne-blush/40 via-fyne-rose/20 to-fyne-plum/10 flex items-center justify-center">
                <div class="absolute inset-[10%] rounded-full bg-white"></div>
                <div class="relative flex flex-col items-center justify-center">
                    <div class="text-3xl font-semibold text-fyne-deep">
                        {{ latest_progress.overall_skin_score|floatformat:0 }}%
                    </div>
                    <div class="text-[11px] tracking-wide uppercase text-slate-400">
                        Skin Score
                    </div>
                </div>
            </div>
        </div>

        <p class="text-center text-[11px] text-slate-500">
            Last updated Â· {{ latest_progress.timestamp|date:"F d, Y" }}
        </p>
    </div>
</section>
{% endif %}

<!-- Daily Checkpoint Status -->
<section class="mb-5">
    <div class="rounded-3xl bg-white shadow-sm border border-slate-100 px-5 py-4">
        <div class="flex items-center justify-between mb-3">
            <h3 class="text-sm font-semibold text-fyne-deep">
                Daily Checkpoint
            </h3>
            {% if today_checkpoint %}
                <div class="inline-flex items-center gap-1 text-emerald-600 text-xs">
                    <i class="fas fa-check-circle text-base"></i>
                    <span>Completed</span>
                </div>
            {% else %}
                <div class="inline-flex items-center gap-1 text-amber-500 text-xs">
                    <i class="fas fa-exclamation-circle text-base"></i>
                    <span>Pending</span>
                </div>
            {% endif %}
        </div>

        {% if today_checkpoint %}
            <p class="text-sm text-emerald-700 mb-3">
                âœ“ Youâ€™ve already done your checkpoint today. Great consistency!
            </p>
            <a href="{% url 'checkpoints:checkpoint_detail' today_checkpoint.pk %}"
               class="inline-flex w-full items-center justify-center gap-2 rounded-2xl bg-slate-900 text-white text-sm font-medium py-2.5 hover:bg-slate-800 transition">
                <span>View details</span>
                <i class="fas fa-angle-right text-xs"></i>
            </a>
        {% else %}
            <p class="text-sm text-slate-600 mb-3">
                You havenâ€™t done your checkpoint yet. Letâ€™s scan your skin in a few seconds.
            </p>
            <a href="{% url 'checkpoints:daily_checkpoint' %}"
               class="inline-flex w-full items-center justify-center gap-2 rounded-2xl bg-gradient-to-r from-fyne-rose to-fyne-blush text-white text-sm font-semibold py-2.5 shadow-fyne-glow hover:opacity-95 transition">
                <i class="fas fa-camera text-sm"></i>
                <span>Take Daily Scan</span>
            </a>
        {% endif %}
    </div>
</section>

<!-- UV Index Today -->
{% if latest_uv %}
<section class="mb-5">
    <div class="rounded-3xl bg-white shadow-sm border border-slate-100 px-5 py-4">
        <div class="flex items-center justify-between mb-4">
            <div>
                <h3 class="text-sm font-semibold text-fyne-deep">
                    UV & Humidity Today
                </h3>
                <p class="text-[11px] text-slate-500 mt-0.5">
                    Remember your sunscreen and hydration.
                </p>
            </div>
            <i class="fas fa-sun text-xl text-amber-400"></i>
        </div>

        <div class="flex justify-around text-center mb-3">
            <div class="flex flex-col items-center">
                <span class="text-2xl font-semibold text-fyne-rose">
                    {{ latest_uv.uv_index }}
                </span>
                <span class="text-[11px] text-slate-500 uppercase tracking-wide">
                    UV Index
                </span>
            </div>
            <div class="flex flex-col items-center">
                <span class="text-2xl font-semibold text-fyne-plum">
                    {{ latest_uv.humidity }}%
                </span>
                <span class="text-[11px] text-slate-500 uppercase tracking-wide">
                    Humidity
                </span>
            </div>
        </div>

        <div class="text-center">
            <a href="{% url 'checkpoints:uv_tracker' %}"
               class="text-[12px] font-medium text-fyne-rose hover:text-fyne-plum transition">
                View full UV report â†’
            </a>
        </div>
    </div>
</section>
{% endif %}

<!-- Active Products / Routine -->
<section class="mb-5">
    <div class="rounded-3xl bg-white shadow-sm border border-slate-100 px-5 py-4">
        <div class="flex items-center justify-between mb-3">
            <h3 class="card-title text-sm font-semibold text-fyne-deep">Your Routine</h3>
            <a href="{% url 'products:product_list' %}"
               class="flex items-center gap-1 text-[11px] font-medium text-fyne-rose hover:text-fyne-plum transition">
                <i class="fas fa-plus-circle"></i>
                <span>Manage</span>
            </a>
        </div>

        {% if active_products %}
            <div class="space-y-3">
                {% for usage in active_products %}
                    <div class="flex items-center gap-3 rounded-2xl bg-fyne-soft/70 px-3 py-2.5">
                        <div class="flex h-9 w-9 items-center justify-center rounded-2xl bg-gradient-to-br from-fyne-rose to-fyne-blush text-white shadow-sm">
                            <i class="fas fa-flask text-sm"></i>
                        </div>
                        <div class="flex-1">
                            <div class="text-sm font-semibold text-fyne-deep">
                                {{ usage.product.name }}
                            </div>
                            <div class="text-[11px] text-slate-500">
                                {{ usage.product.brand }} â€¢ {{ usage.get_frequency_display }}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>

            {% if active_products|length >= 5 %}
                <a href="{% url 'products:product_list' %}"
                   class="mt-4 inline-flex w-full items-center justify-center rounded-2xl border border-fyne-soft bg-white text-[13px] font-medium text-fyne-plum py-2 hover:bg-fyne-soft transition">
                    View all products
                </a>
            {% endif %}
        {% else %}
            <div class="flex flex-col items-center text-center py-4">
                <div class="mb-2 text-2xl">ðŸ’§</div>
                <div class="text-sm font-semibold text-fyne-deep mb-1">
                    No products yet
                </div>
                <p class="text-[12px] text-slate-500 mb-3">
                    Start building a routine tailored to your skin.
                </p>
                <a href="{% url 'products:product_list' %}"
                   class="inline-flex items-center justify-center rounded-2xl bg-gradient-to-r from-fyne-rose to-fyne-blush text-white text-sm font-semibold px-4 py-2 shadow-fyne-glow hover:opacity-95 transition">
                    Add products
                </a>
            </div>
        {% endif %}
    </div>
</section>

<!-- Quick Stats -->
<section class="mb-3">
    <div class="rounded-3xl bg-white shadow-sm border border-slate-100 px-5 py-4">
        <h3 class="text-sm font-semibold text-fyne-deep mb-3">
            Last 7 Days
        </h3>
        <div class="grid grid-cols-2 gap-3">
            <div class="rounded-2xl bg-fyne-soft px-3 py-3 text-center">
                <div class="text-2xl font-semibold text-fyne-deep">
                    {{ recent_checkpoints|length }}
                </div>
                <div class="text-[11px] text-slate-500 uppercase tracking-wide">
                    Checkpoints
                </div>
            </div>
            <div class="rounded-2xl bg-fyne-soft px-3 py-3 text-center">
                <div class="text-2xl font-semibold text-fyne-rose">
                    {{ active_products|length }}
                </div>
                <div class="text-[11px] text-slate-500 uppercase tracking-wide">
                    Active Products
                </div>
            </div>
        </div>
    </div>
</section>

{% endblock %}
